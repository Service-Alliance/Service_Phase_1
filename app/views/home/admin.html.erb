<!-- <div class="col-sm-12 col-lg-12 main">
	<div class="row">
		<ol class="breadcrumb">
			<li>
				<a href="#">
					<svg class="glyph stroked home">
						<use xlink:href="#stroked-home"></use>
					</svg>
				</a>
			</li>
			<li class="active">Dashboard</li>
		</ol>
	</div> -->
<!--/.row-->
<div class="container-fluid">

	<section id="home">

		<div class="row">
			<div class="col-lg-12">
				<h1 class="page-header text-center">Dashboard</h1>
			</div>
		</div>
		<!--/.row-->

		<div class="row">
			<div class="col-xs-12 col-md-6 col-lg-3">
				<div class="panel panel-blue panel-widget ">
					<div class="row no-padding">
						<div class="col-sm-3 col-lg-5 widget-left">
							<i class="glyph-dash glyphicon glyphicon-star-empty" aria-hidden="true"></i>
						</div>
						<div class="col-sm-9 col-lg-7 widget-right">
							<div class="large"><%= @active_leads %></div>
							<div class="text-muted">Active Leads</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-xs-12 col-md-6 col-lg-3">
				<div class="panel panel-orange panel-widget">
					<div class="row no-padding">
						<div class="col-sm-3 col-lg-5 widget-left">
							<i class="glyph-dash glyphicon glyphicon-star" aria-hidden="true"></i>
						</div>
						<div class="col-sm-9 col-lg-7 widget-right">
							<div class="large"><%= @active_jobs %></div>
							<div class="text-muted">Active Jobs</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-xs-12 col-md-6 col-lg-3">
				<div class="panel panel-teal panel-widget">
					<div class="row no-padding">
						<div class="col-sm-3 col-lg-5 widget-left">
							<i class="glyph-dash glyphicon glyphicon-earphone" aria-hidden="true"></i>
						</div>
						<div class="col-sm-9 col-lg-7 widget-right">
							<div class="large"><%= @month_calls %></div>
							<div class="text-muted">Calls (Monthly)</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-xs-12 col-md-6 col-lg-3">
				<div class="panel panel-red panel-widget">
					<div class="row no-padding">
						<div class="col-sm-3 col-lg-5 widget-left">
							<i class="glyph-dash glyphicon glyphicon-earphone" aria-hidden="true"></i>
						</div>
						<div class="col-sm-9 col-lg-7 widget-right">
							<div class="large"><%= @ongoing_calls %></div>
							<div class="text-muted">In Progress Calls</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="row">
			<div class="col-lg-12">
				<div class="panel panel-default">
					<div class="panel-heading">Jobs</div>
					<div class="panel-body">
						<!-- <table id="table"
				           data-toolbar="#toolbar"
				           data-search="true"
				           data-show-refresh="true"
				           data-show-toggle="true"
				           data-show-columns="true"
				           data-show-export="true"
				           data-detail-view="true"
				           data-detail-formatter="detailFormatter"
				           data-minimum-count-columns="2"
				           data-show-pagination-switch="true"
				           data-pagination="true"
				           data-id-field="id"
				           data-page-list="[10, 25, 50, 100, ALL]"
				           data-show-footer="false"
				           data-side-pagination="server"
				           data-url="/examples/bootstrap_table/data"
				           data-response-handler="responseHandler">
				    </table> -->
						<table
							class="table-responsive"
							data-toggle="table"
							data-url="/jobs/list"
							data-show-refresh="true"
							data-show-toggle="true"
							data-show-columns="true"
							data-search="true"
							data-flat="true"
							data-select-item-name="toolbar1"
							data-pagination="true"
							data-sort-name="id"
							data-sort-order="desc">
							<thead>
								<tr>
									<th data-field="id" data-sort-order='desc' data-sortable="true" data-formatter="LinkFormatter">Job ID</th>
									<th data-field="job_status.name" data-sortable="true">Status</th>
									<th data-field="customer.last_name" data-sortable="true">Last Name</th>
									<th data-field="customer.first_name" data-sortable="true">First Name</th>
									<th data-field="job_detail.claim_number" data-sortable="true">Claim Number</th>
									<th data-field="job_loss_type.name" data-sortable="true">Job Loss Type</th>
									<th data-field="insurance_details.name" data-sortable="true">Insurance Carrier</th>
									<th data-field="created_at" data-sortable="true">Date Received</th>

								</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>

			<div class="col-lg-6">
				<div class="panel panel-default">
					<div class="panel-heading">Users</div>
					<div class="panel-body">
						<table
							data-toggle="table"
							data-url="users/list"
							data-show-refresh="true"
							data-show-toggle="true"
							data-show-columns="true"
							data-search="true"
							data-flat="true"
							data-select-item-name="toolbar1"
							data-pagination="true"
							data-sort-name="id"
							data-sort-order="asc">
							<thead>
								<tr>
									<th data-field="id" data-sortable="true" data-formatter="UserLinkFormatter">User ID</th>
									<th data-field="first_name" data-sortable="true">First Name</th>
									<th data-field="last_name" data-sortable="true">Last Name</th>
									<th data-field="department.name" data-sortable="true">Department</th>
								</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>

			<div class="col-lg-6">
				<div class="panel panel-default">
					<div class="panel-heading">Job Manager Assignments</div>
					<div class="panel-body">
						<table
							data-toggle="table"
							data-url="job_managers"
							data-show-refresh="true"
							data-show-toggle="true"
							data-show-columns="true"
							data-search="true"
							data-flat="true"
							data-select-item-name="toolbar1"
							data-pagination="true"
							data-sort-name="id"
							data-sort-order="desc">
							<thead>
								<tr>
									<th data-field="id" data-sort-order='desc' data-sortable="true" data-formatter="UserLinkFormatter">Scheulded ID</th>
									<th data-field="job_manager.first_name" data-sortable="true">First Name</th>
									<th data-field="job_manager.last_name" data-sortable="true">Last Name</th>
									<th data-field="schedule_datetime" data-sortable="true">Scheduled On</th>
									<th data-field="manager_confirmation" data-sortable="true">Confirmed</th>
								</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>

			<div class="col-lg-6">
				<div class="panel panel-default">
					<div class="panel-heading">Dead Leads (7 days or more with no activity)</div>
					<div class="panel-body">
						<table
							data-toggle="table"
							data-url="/jobs/no-activity"
							data-show-refresh="true"
							data-show-toggle="true"
							data-show-columns="true"
							data-search="true"
							data-flat="true"
							data-select-item-name="toolbar1"
							data-pagination="true"
							data-sort-name="id"
							data-sort-order="desc">
							<thead>
								<tr>
									<th data-field="id" data-sort-order='desc' data-sortable="true" data-formatter="LinkFormatter">Job ID</th>
									<th data-field="job_status.name" data-sortable="true">Status</th>
									<th data-field="customer.last_name" data-sortable="true">Last Name</th>
									<th data-field="customer.first_name" data-sortable="true">First Name</th>
									<th data-field="job_detail.claim_number" data-sortable="true">Claim Number</th>
									<th data-field="job_loss_type.name" data-sortable="true">Job Loss Type</th>
									<th data-field="insurance_details.name" data-sortable="true">Insurance Carrier</th>
									<th data-field="created_at" data-sortable="true">Date Received</th>

								</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>

			<div class="col-lg-6">
				<div class="panel panel-default">
					<div class="panel-heading">Work Orders Created</div>
					<div class="panel-body">
						<table
							data-toggle="table"
							data-url="work_orders"
							data-show-refresh="true"
							data-show-toggle="true"
							data-show-columns="true"
							data-search="true"
							data-flat="true"
							data-select-item-name="toolbar1"
							data-pagination="true"
							data-sort-name="id"
							data-sort-order="desc">
							<thead>
								<tr>
									<th data-field="id" data-formatter="WorkOrderLinkFormatter" data-sort-order='desc' data-sortable="true">Word Order ID</th>
									<th data-field="job_id" data-formatter="JobLinkFormatter" data-sortable="true">Job ID</th>
									<th data-field="job_id" data-formatter="WorkOrderAcknowledge" data-sortable="true">Acknowledge Job</th>
									<th data-field="created_at"  data-sortable="true">Created At<th>
								</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>

			<div class="col-lg-6">
				<div class="panel panel-default">
					<div class="panel-heading">Jobs Created By Call Reps</div>
					<div class="panel-body">
						<table
							data-toggle="table"
							data-url="/jobs/call_rep_jobs"
							data-show-refresh="true"
							data-show-toggle="true"
							data-show-columns="true"
							data-search="true"
							data-flat="true"
							data-select-item-name="toolbar1"
							data-pagination="true"
							data-sort-name="id"
							data-sort-order="desc">
							<thead>
								<tr>
									<th data-field="id" data-sort-order='desc' data-sortable="true" data-formatter="LinkFormatter">Job ID</th>
									<th data-field="job_status.name" data-sortable="true">Status</th>
									<th data-field="customer.last_name" data-sortable="true">Last Name</th>
									<th data-field="customer.first_name" data-sortable="true">First Name</th>
									<th data-field="job_detail.claim_number" data-sortable="true">Claim Number</th>
									<th data-field="job_loss_type.name" data-sortable="true">Job Loss Type</th>
									<th data-field="insurance_details.name" data-sortable="true">Insurance Carrier</th>
									<th data-field="created_at" data-sortable="true">Date Received</th>

								</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>

			<div class="col-lg-6">
				<div class="panel panel-default">
					<div class="panel-heading">Jobs without Coorindator</div>
					<div class="panel-body">
						<table
							data-toggle="table"
							data-url="/jobs/unassigned_job"
							data-show-refresh="true"
							data-show-toggle="true"
							data-show-columns="true"
							data-search="true"
							data-flat="true"
							data-select-item-name="toolbar1"
							data-pagination="true"
							data-sort-name="id"
							data-sort-order="desc">
							<thead>
								<tr>
									<th data-field="id" data-sort-order='desc' data-sortable="true" data-formatter="LinkFormatter">Job ID</th>
									<th data-field="job_status.name" data-sortable="true">Status</th>
									<th data-field="customer.last_name" data-sortable="true">Last Name</th>
									<th data-field="customer.first_name" data-sortable="true">First Name</th>
									<th data-field="job_detail.claim_number" data-sortable="true">Claim Number</th>
									<th data-field="job_loss_type.name" data-sortable="true">Job Loss Type</th>
									<th data-field="insurance_details.name" data-sortable="true">Insurance Carrier</th>
									<th data-field="created_at" data-sortable="true">Date Received</th>

								</tr>
							</thead>
						</table>
					</div>
				</div>
			</div>
		</div>


<div class="col-md-8 col-md-offset-2">
<% unless @jobs.empty? %>
<% @jobs.each do |job| %>
<%
	job_array = job.trackers.sort_by{|x| x.created_at}
	%>
<div class="panel panel-default">
	<div class="panel-heading">
		Job ID: <%= link_to job.id, job_path(job) %>
	</div>
	<div class="panel-body">
		Progress:
		<div class="progress">
			<div class="progress-bar progress-bar-info progress-bar-striped" role="progressbar" aria-valuenow="<%= job.progress %>" aria-valuemin="0" aria-valuemax="100" style="width: <%= job.progress %>%"></div>
		</div>
		<div class="row">

			<div class="timeline-centered">
				<% job_array.each do |tracker| %>
				<article class="timeline-entry">
					<div class="timeline-entry-inner">
						<div class="timeline-icon bg-success">
							<i class="entypo-feather"></i>
						</div>
						<div class="timeline-label">
							<h2>
								<%= link_to tracker_link_to(tracker.tracker_task_id, tracker.trackable_id) do %>
								<%= tracker.tracker_task.name %>
								<% end %>
							</span>
						</h2>
						<% if tracker.tracker_task_id == 2 %>
							<% @job_manager = JobManager.find_by(id: tracker.child_id) %>
								Manager: <%= @job_manager.try(:job_manager).try(:full_name) %><br />
								Scheduled Date: <%= @job_manager.try(:schedule_date) %>
						<% end %>
						<p>Date:
							<%= tracker.created_at %></p>
					</div>

				</div>
			</article>
			<% end %>
			<div class="next-step text-center">


			<% if job_array.last.try(:tracker_task_id) %>
				<%= link_to job_array.last.try(:next_step_task),  next_step_link(job_array.last.tracker_task_id, job_array.last.trackable_id), class: "btn btn-primary" %>
			<% end %>
			</div>
		</div>
	</div>
</div>
</div>
<% end %>
<% end %>
</div>

</div>

<script>
function LinkFormatter(value, row, index) {
	return "<a href='jobs/" + row.id + "'>" + value + "</a>";
}
function UserLinkFormatter(value, row, index) {
	return "<a href='users/" + row.id + "'>" + value + "</a>";
}
function WorkOrderLinkFormatter(value, row, index) {
	return "<a href='jobs/" + row.job_id + "/work_orders/" + row.id + "'>" + value + "</a>";
}
function JobLinkFormatter(value, row, index) {
	return "<a href='jobs/" + row.job_id +"'>" + value + "</a>";
}
function WorkOrderAcknowledge(value, row, index) {
	if (row.acknowledgement == true) {
		return "Work Order Acknolwedged"
	} else {
		return "<a href='jobs/" + row.job_id +"/work_orders/" + row.id + "/acknolwedge'>Acknolwedge Work Order</a>";
	}

}
</script>
